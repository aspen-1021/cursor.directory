# 机器人建筑用户偏好研究系统 - 使用说明

## 📋 系统概述

这是一个完整的交互式用户偏好研究系统，专门用于收集用户对机器人搭建不同规模房屋的偏好数据。系统采用现代Web技术栈，提供流畅的用户体验和全面的数据收集功能。

## 🏗️ 系统架构

### 核心组件
- **主应用程序** (`App.jsx`) - 应用入口，协调所有组件
- **交互组件** (`components/InteractionComponents.jsx`) - 各种用户交互界面
- **事件管理器** (`utils/EventManager.js`) - 数据收集和事件处理
- **样式文件** (`styles/App.css`) - 现代美观的界面设计

### 技术栈
- **前端框架**: React 18+
- **动画库**: Framer Motion
- **样式**: CSS3 (支持响应式设计)
- **数据存储**: LocalStorage + 服务器端API
- **兼容性**: 支持现代浏览器和移动设备

## 🚀 快速开始

### 1. 环境准备

```bash
# 确保已安装Node.js (版本 >= 16)
node --version

# 创建新的React项目
npx create-react-app robot-house-survey
cd robot-house-survey

# 安装依赖
npm install framer-motion
```

### 2. 文件部署

将以下文件复制到对应位置：

```
src/
├── App.jsx                           # 主应用组件
├── components/
│   └── InteractionComponents.jsx     # 交互组件
├── utils/
│   └── EventManager.js              # 事件管理器
└── styles/
    └── App.css                      # 样式文件
```

### 3. 资源文件准备

在 `public/` 目录下创建以下文件夹结构：

```
public/
├── images/
│   ├── large-house.jpg              # 大型房屋图片
│   ├── medium-house.jpg             # 中型房屋图片
│   └── small-house.jpg              # 小型房屋图片
└── videos/
    ├── large-house-build.mp4        # 大型房屋搭建视频
    ├── medium-house-build.mp4       # 中型房屋搭建视频
    └── small-house-build.mp4        # 小型房屋搭建视频
```

### 4. 启动应用

```bash
# 开发模式启动
npm start

# 生产构建
npm run build
```

## 📱 功能模块详解

### 1. 欢迎页面
- **功能**: 介绍研究目的和流程
- **用户操作**: 点击开始按钮进入研究
- **数据收集**: 记录用户进入时间和基本信息

### 2. 基本信息收集
- **功能**: 收集用户人口统计学信息
- **表单字段**:
  - 年龄范围
  - 性别
  - 教育程度
  - 职业领域
  - 居住经历
  - 技术接受度
- **数据收集**: 表单提交数据 + 填写行为追踪

### 3. 初始偏好调查
- **功能**: 了解用户对机器人建筑的预期
- **调查内容**:
  - 对机器人建筑的初始印象
  - 理想房屋规模偏好
  - 重要因素选择（多选）
- **数据收集**: 选择记录 + 选择时间 + 变更历史

### 4. 房屋展示阶段
- **功能**: 展示三种规模房屋的机器人搭建过程
- **交互功能**:
  - 视频播放控制
  - 实时情感滑块反馈
  - 多维度星级评分
- **数据收集**: 
  - 视频观看行为（播放/暂停/跳转）
  - 实时情感变化数据
  - 五维度评分数据
  - 观看时长统计

### 5. 对比评估阶段
- **功能**: 三种房屋的并排对比和排序
- **交互功能**:
  - 房屋卡片对比展示
  - 拖拽排序界面
  - 特征高亮功能
- **数据收集**:
  - 点击和浏览行为
  - 排序变化记录
  - 决策时间统计

### 6. 深度访谈阶段
- **功能**: 收集开放性反馈意见
- **交互功能**:
  - 语音录制功能
  - 文字输入选项
  - 多个问题逐一回答
- **数据收集**:
  - 语音数据或文字回答
  - 回答时长
  - 回答质量指标

### 7. 完成页面
- **功能**: 总结和数据导出
- **功能特点**:
  - 参与总结展示
  - 数据导出功能
  - 感谢和隐私提醒

## 🎛️ 事件追踪系统

### 自动追踪事件
- **页面行为**: 进入/离开、焦点变化、可见性变化
- **鼠标行为**: 移动轨迹、点击位置、滚动行为
- **时间数据**: 页面停留时间、阶段用时、总参与时长
- **技术指标**: 设备信息、浏览器信息、网络状态

### 交互事件
- **情感反馈**: 滑块数值变化、变化频率、情感强度
- **评分行为**: 星级选择、修改记录、完整性检查
- **排序操作**: 拖拽行为、位置变化、决策路径
- **多媒体交互**: 视频播放控制、观看进度、重复观看

### 数据质量控制
- **完整性检查**: 必填项验证、数据缺失检测
- **一致性验证**: 前后回答对比、逻辑矛盾检测
- **异常值检测**: 响应时间异常、行为模式异常
- **重复性过滤**: 同一用户多次参与检测

## 📊 数据分析功能

### 实时分析
```javascript
// 获取用户参与度分析
const analyzer = new EventAnalyzer(eventManager.events);
const engagement = analyzer.analyzeEngagement();

// 分析偏好模式
const preferences = analyzer.analyzePreferencePatterns();

// 生成可视化数据
const vizData = analyzer.generateVisualizationData();
```

### 导出数据格式
```json
{
  "sessionInfo": {
    "sessionId": "session_timestamp_random",
    "startTime": 1640995200000,
    "endTime": 1640998800000,
    "totalDuration": 3600000
  },
  "surveyData": {
    "demographics": { /* 人口统计学数据 */ },
    "initialPreferences": { /* 初始偏好数据 */ },
    "houseRatings": { /* 房屋评分数据 */ },
    "finalRanking": [ /* 最终排序结果 */ ],
    "interviews": { /* 访谈回答数据 */ }
  },
  "eventData": {
    "events": [ /* 所有事件记录 */ ],
    "stats": { /* 统计分析结果 */ }
  }
}
```

## 🛠️ 自定义配置

### 1. 修改房屋数据
在 `App.jsx` 中更新 `housesData` 对象：

```javascript
const housesData = {
  '大型房屋': {
    type: '大型房屋',
    image: '/images/your-large-house.jpg',
    video: '/videos/your-large-house-video.mp4',
    features: ['自定义特征1', '自定义特征2'],
    area: '您的面积',
    buildTime: '您的时间',
    description: '您的描述'
  }
  // ... 其他房屋配置
};
```

### 2. 调整评分维度
修改 `HouseExhibitionStep` 组件中的维度数组：

```javascript
const dimensions = [
  '您的维度1', 
  '您的维度2', 
  '您的维度3',
  // ... 更多维度
];
```

### 3. 自定义问卷问题
在相应组件中修改问题数组：

```javascript
// 访谈问题自定义
const questions = [
  "您的自定义问题1？",
  "您的自定义问题2？",
  // ... 更多问题
];
```

### 4. 样式主题定制
在 `App.css` 中修改CSS变量：

```css
:root {
  --primary-color: #your-color;
  --secondary-color: #your-color;
  --background-gradient: linear-gradient(135deg, #color1 0%, #color2 100%);
}
```

## 🔧 服务器端集成

### API 端点需求

```javascript
// 事件数据接收
POST /api/events
Content-Type: application/json
Body: { event data }

// 批量事件同步
POST /api/events/batch
Content-Type: application/json
Body: [{ event data array }]

// 数据导出
GET /api/export/:sessionId
Response: { complete session data }
```

### 数据库设计建议

```sql
-- 会话表
CREATE TABLE sessions (
  id VARCHAR(255) PRIMARY KEY,
  start_time BIGINT,
  end_time BIGINT,
  user_agent TEXT,
  ip_address VARCHAR(45)
);

-- 事件表
CREATE TABLE events (
  id VARCHAR(255) PRIMARY KEY,
  session_id VARCHAR(255),
  event_type VARCHAR(100),
  event_data JSON,
  timestamp BIGINT,
  FOREIGN KEY (session_id) REFERENCES sessions(id)
);

-- 调查数据表
CREATE TABLE survey_data (
  session_id VARCHAR(255) PRIMARY KEY,
  demographics JSON,
  preferences JSON,
  ratings JSON,
  rankings JSON,
  interviews JSON,
  FOREIGN KEY (session_id) REFERENCES sessions(id)
);
```

## 📱 移动端适配

### 响应式设计特点
- **自适应布局**: 自动适配不同屏幕尺寸
- **触摸优化**: 按钮尺寸和间距适合触摸操作
- **手势支持**: 拖拽排序支持触摸手势
- **性能优化**: 针对移动设备优化动画和交互

### 测试建议
```bash
# 使用Chrome开发者工具测试
# 1. 打开开发者工具
# 2. 点击设备模拟器图标
# 3. 选择不同设备尺寸测试
# 4. 测试触摸交互和滚动行为
```

## 🔒 隐私和安全

### 数据保护措施
- **本地存储**: 使用localStorage作为数据备份
- **数据匿名化**: 不收集个人身份信息
- **加密传输**: 使用HTTPS传输数据
- **自动清理**: 设置数据保存期限

### 用户同意管理
```javascript
// 在开始前获取用户同意
const userConsent = {
  dataCollection: true,
  voiceRecording: true,
  behaviorTracking: true,
  dataRetention: '30days'
};
```

## 📈 性能优化

### 前端优化
- **代码分割**: 使用React.lazy进行组件懒加载
- **图片优化**: 使用WebP格式和适当尺寸
- **缓存策略**: 合理使用浏览器缓存
- **包大小**: 移除未使用的依赖

### 数据优化
- **事件节流**: 限制高频事件的记录频率
- **批量发送**: 批量发送事件数据减少请求
- **离线支持**: 网络中断时本地存储数据
- **增量同步**: 仅同步新增或变更的数据

## 🐛 常见问题解决

### 1. 语音录制不工作
```javascript
// 检查浏览器支持
if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
  console.error('浏览器不支持语音录制');
  // 提供文字输入替代方案
}

// 检查权限
navigator.permissions.query({name: 'microphone'})
  .then(result => console.log(result.state));
```

### 2. 视频无法播放
```javascript
// 检查视频格式支持
const video = document.createElement('video');
const canPlayMP4 = video.canPlayType('video/mp4');
console.log('MP4支持:', canPlayMP4);
```

### 3. 数据丢失问题
```javascript
// 增加数据保存频率
setInterval(() => {
  eventManager.saveToLocalStorage();
}, 5000); // 每5秒保存一次
```

### 4. 性能问题
```javascript
// 使用React.memo优化组件渲染
const OptimizedComponent = React.memo(YourComponent);

// 使用useMemo缓存计算结果
const expensiveValue = useMemo(() => {
  return computeExpensiveValue(props);
}, [props]);
```

## 📞 技术支持

### 开发调试
```javascript
// 启用详细日志
localStorage.setItem('debug', 'true');

// 查看事件统计
console.log(eventManager.getSessionStats());

// 导出调试数据
console.log(eventManager.exportData());
```

### 浏览器兼容性
- **Chrome 90+** ✅ 完全支持
- **Firefox 88+** ✅ 完全支持  
- **Safari 14+** ⚠️ 语音功能可能受限
- **Edge 90+** ✅ 完全支持
- **移动浏览器** ✅ 基础功能支持

### 部署建议
- **域名要求**: 建议使用HTTPS域名
- **服务器配置**: 支持大文件上传（语音数据）
- **CDN加速**: 静态资源使用CDN加速
- **监控告警**: 设置错误监控和性能监控

---

**祝您使用愉快！如有问题，请查看控制台日志或联系技术支持。**